# Анализ обновления библиотеки Chessground с версии 9.0.4 до 9.2.1

## Информация о версиях

- **Текущая версия**: 9.0.4
- **Последняя версия**: 9.2.1
- **Дата анализа**: 12 января 2026 года

## Таблица анализа изменений

| Версия | Дата выпуска | Основные изменения | Тип изменения |
|--------|--------------|-------------------|---------------|
| **9.0.5** | 18 апреля 2024 | - Экспорт CSS переменных ширины и высоты с тремя дефисами в качестве алиасов<br>- Обновление dev-зависимостей<br>- Удаление обратной совместимости названия `addDimensionsCssVarsTo` | Минорное улучшение |
| **9.1.0** | 1 мая 2024 | - **Новая функция**: Добавлена опция `coordinatesOnSquares` для отображения координат на каждой клетке<br>- Улучшена работа с CSS для координат<br>- Оптимизированы CSS селекторы (удалено 8+ ненужных селекторов) | Функциональное обновление |
| **9.1.1** | 6 мая 2024 | - Сделано свойство `Config.coordinatesOnSquares` опциональным<br>- Типизация для новой функции координат | Исправление типов |
| **9.2.0** | 9 ноября 2024 | - **Новая функция**: Добавлен тип `Role` в `chessground/types`<br>- Улучшена типизация TypeScript | Улучшение типов |
| **9.2.1** | 15 мая 2025 | - **Исправление безопасности**: Устранена уязвимость prototype pollution в функции `deepMerge`, обнаруженная CodeQL<br>- Обновление зависимости esbuild с 0.24.0 до 0.25.0<br>- Обновление зависимости cross-spawn с 7.0.3 до 7.0.6<br>- Обновление зависимости micromatch с 4.0.5 до 4.0.8<br>- Обновление зависимости braces с 3.0.2 до 3.0.3<br>- Улучшен CSS для размещения и цвета текста координат<br>- Включена поддержка импорта CSS файлов из chessground assets в Next.js проектах | Исправления безопасности и багфиксы |

## Детальное описание новых функций

### 1. Координаты на каждой клетке (v9.1.0)

**Описание**: Новая опция конфигурации `coordinatesOnSquares`, которая позволяет отображать координаты шахматной доски (например, "e4", "d5") непосредственно на каждой клетке, а не только по краям доски.

**Использование**:
```typescript
{
  coordinatesOnSquares: true
}
```

**Преимущества**:
- Улучшает читаемость для обучающих целей
- Полезно для начинающих игроков
- Дополнительные варианты визуализации доски

### 2. Улучшенная типизация Role (v9.2.0)

**Описание**: Добавлен экспорт типа `Role` в `chessground/types`, что улучшает поддержку TypeScript.

**Преимущества**:
- Лучшая типобезопасность при работе с фигурами
- Улучшенная автодополнение в IDE

### 3. Исправление CSS импортов для Next.js (v9.2.1)

**Описание**: Включена поддержка импорта CSS файлов из chessground assets в проектах на Next.js.

**Преимущества**:
- Упрощает интеграцию с современными фреймворками
- Решает проблемы совместимости с Next.js

### 4. Улучшения CSS координат (v9.2.1)

**Описание**: Улучшен CSS для более точного размещения и управления цветом текста координат.

**Преимущества**:
- Лучшая визуальная согласованность
- Более гибкая настройка внешнего вида

## Исправления безопасности

### Критическая уязвимость: Prototype Pollution (v9.2.1)

**Описание**: Была обнаружена и устранена уязвимость prototype pollution в функции `deepMerge`. Эта уязвимость была идентифицирована с помощью инструмента статического анализа кода CodeQL.

**Уровень критичности**: Средний

**Влияние**: Потенциальная возможность изменения прототипов объектов JavaScript, что может привести к неожиданному поведению или уязвимостям безопасности.

**Статус**: Исправлено в версии 9.2.1

## Обновления зависимостей

Между версиями были обновлены следующие зависимости (в основном dev-зависимости):

| Зависимость | Старая версия | Новая версия | Причина |
|-------------|---------------|--------------|---------|
| esbuild | 0.24.0 | 0.25.0 | Обновление сборщика |
| cross-spawn | 7.0.3 | 7.0.6 | Исправление безопасности |
| micromatch | 4.0.5 | 4.0.8 | Исправление безопасности |
| braces | 3.0.2 | 3.0.3 | Исправление безопасности |

## Оценка безопасности обновления для продакшна

### ✅ РЕКОМЕНДУЕТСЯ обновление

**Уровень риска**: Низкий

**Обоснование**:

1. **Исправления безопасности** (Критично):
   - Версия 9.2.1 содержит важное исправление уязвимости prototype pollution
   - Обновлены зависимости с известными уязвимостями безопасности
   - **Настоятельно рекомендуется** для продакшн-окружения

2. **Обратная совместимость** (Отлично):
   - Все изменения между 9.0.4 и 9.2.1 являются обратно совместимыми
   - Новые функции являются опциональными (например, `coordinatesOnSquares`)
   - Никаких breaking changes не зафиксировано
   - Существующий код продолжит работать без изменений

3. **Новые функции** (Низкий риск):
   - Все новые функции опциональны
   - Не требуют изменений существующего кода
   - Можно использовать при необходимости

4. **Улучшения TypeScript** (Плюс):
   - Улучшена типизация без изменения API
   - Лучшая поддержка в IDE

5. **Обновления зависимостей** (Положительно):
   - Все обновления зависимостей являются патч-версиями или минорными
   - Устраняют известные уязвимости безопасности

### Рекомендации по обновлению

#### Шаг 1: Обновление версии
```bash
# Через npm
npm install chessground@9.2.1

# Через yarn
yarn add chessground@9.2.1
```

#### Шаг 2: Тестирование
1. Запустите существующие тесты
2. Проверьте основные сценарии использования:
   - Отображение доски
   - Перемещение фигур
   - Стрелки и выделения
   - Анимации

#### Шаг 3: Опциональное использование новых функций
Если требуется, можно активировать новые функции:

```typescript
// Пример использования координат на клетках
const config = {
  coordinatesOnSquares: true,
  // ... остальные настройки
};
```

### Потенциальные проблемы

**Минимальные**:
- Если вы используете устаревшее имя `addDimensionsCssVarsTo`, его нужно обновить (удалено в 9.0.5)
- Возможны минимальные визуальные изменения CSS для координат

### План отката (на случай проблем)

```bash
# Откат к версии 9.0.4
npm install chessground@9.0.4
# или
yarn add chessground@9.0.4
```

## Заключение

**Обновление с версии 9.0.4 до 9.2.1 НАСТОЯТЕЛЬНО РЕКОМЕНДУЕТСЯ для продакшн-окружения.**

Причины:
- ✅ Исправлена важная уязвимость безопасности (prototype pollution)
- ✅ Обновлены зависимости с известными уязвимостями
- ✅ 100% обратная совместимость
- ✅ Новые полезные функции (опциональные)
- ✅ Улучшенная типизация TypeScript
- ✅ Никаких breaking changes
- ✅ Низкий риск проблем

**Рекомендуемый срок обновления**: В ближайшее время (в течение 1-2 недель)

**Приоритет**: Высокий (из-за исправлений безопасности)
